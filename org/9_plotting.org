#+title: Basic plotting in R
#+AUTHOR: Marcus Birkenkrahe
#+SUBTITLE: Introduction to data science (DSC 105) Fall 2022
#+OPTIONS: toc:nil num:nil
#+STARTUP: overview hideblocks indent inlineimages
#+PROPERTY: header-args:R :session *R* :exports both :results output
* What are you going to learn?
#+attr_html: :width 600px
[[../img/whiskers.jpg]]

- Why visualization? What does it depend on?
- What types of charts are there?
- Barplots and pie charts
- Histograms
- Box-and-Whisker Plots
- Scatterplots
- Using base R and ggplot2

  This section closely follows the presentation in Davies (2016),
  chapter 14, pp. 289-308.

* When do we visualize data? When don't we?
#+attr_html: :width 600px
[[../img/9_bigpicture.jpg]]
#+begin_notes
Data visualization is important for EXPLORATION and for DOCUMENTATION:

1) During data exploration (EDA), we visualize to see patterns rather
   than rely on summary statistics and numbers only
2) During data storytelling, we document and communicate insights
   using graphs rather than tables

It's easy to miss *relevant details* in graphs, and it's easy to miss
the *big picture* in tables.
#+end_notes
* What does visualization depend on?
#+attr_html: :width 600px
[[../img/9_viz.png]]
(Source: r-charts.com - base R and ggplot2 examples[fn:1])
#+begin_notes

1) Raw/transformed data (observations and experiments)

2) Available/affordable tools (computing and infrastructure)

3) Variable types/style (related to the programming language)

4) Skill/Benefit (data scientists and data science customers)

#+end_notes
* What types of visualizations are there?
#+attr_html: :width 700px
[[../img/9_chart_types.png]]
(Source: r-graph-gallery.com)
#+begin_notes
- Plots with bars (bar plot, histogram, lollipop, dotplot, pie chart)

- Plots with curves (density, ridgeline)

- Plots with points (scatterplot, bubbleplot, correlogram, line plot)

- Plots with areas (mosaicplot, boxplot, violinplot)

- Plots with trees (treemap, dendrogram)
#+end_notes
* Barplots and Pie charts

- Barplots and pie charts are used to visualize *qualitative* data by
  *category frequency*

- The height of the bars of a barplot indicate the frequency or count
  of each category

* Frequency tables

- The frequencies can be computed using the ~table~ function

- Example: look at the dataset ~ToothGrowth~ - it has two ~numeric~ and
  one ~factor~ variable.
  #+begin_src R
    str(ToothGrowth)
    tg <- ToothGrowth
  #+end_src
- Compute the frequencies for the variables of ~ToothGrowth~ 
  #+begin_src R
    table(tg$len)
    table(tg$supp)
    table(tg$dose)
  #+end_src

- What do these results mean? Which questions does each ~table~ result
  answer?
  #+begin_quote
  How many observations correspond to the values of ~len~, ~supp~ and
  ~dose~?
  #+end_quote

- What kind of R data structure is this frequency table? What
  structure does a table have? Is the table named or unnamed?
  #+begin_src R
    tbl <- table(ToothGrowth$supp)
    class(tbl)
    str(tbl)
    names(tbl)
  #+end_src
* How to build a barplot
#+attr_html: :width 400px
[[../img/errorbar.png]]

- A barplot draws vertical or horizontal bars separated by white
  space, to visualize frequencies according to the relevant categories

- You can visualize raw quantities (i.e. counts), or functions of
  them, like the ~mean~ or proportions

- For more than one variable, the bars can be stacked or dodged (drawn
  next to one another)

- Example: to build barplots for any variable, we merely pass the
  frequency table to the ~barplot~ function. The value of each table
  entry determines the height of the bar: ~barplot(table(var))~

* Building a barplot for  ~mtcars~

- As an example let's use ~mtcars~, which contains characteristics of 32
  classic performance cars in the mid-1970s.

- Print the first 5 rows of the data frame ~mtcars~
  #+begin_src R
    head(mtcars,5)
  #+end_src

- We're only interested in one variable, ~cyl~, the number of cylinders
  of the cars listed.

- We use ~table~ to find out how many cars have how many cylinders and
  store the result in ~cyl.freq~
  #+begin_src R
    cyl.freq <- table(mtcars$cyl)
    cyl.freq
  #+end_src

- We create a barplot of the cylinder frequencies in ~mtcar~
  #+begin_src R :results graphics file :file ../img/9_cyl.png
    barplot(cyl.freq)
  #+end_src

- The plot displays the number of 4-, 6- and 8-cylinder cars in the
  data set but without annotations it's not clear what is summarized

* Annotating a barplot

- Annotating a barplot works no different than annotating any plot,
  which is a great advantage of base R plotting

- The ~barplot~ function has a bunch of parameters, which you can view
  with ~help~ (if you run this in Org-mode, you have to quit with ~C-g~)
  #+begin_src R
    help(barplot)
  #+end_src

- For simple annotation, we need:
  1) title
  2) x-axis label
  3) y-axis label
    #+begin_src R :results graphics file :file ../img/9_cyl_ann.png
    barplot(
      height = cyl.freq,
      main = "Barplot of 4-, 5- and 6-cylinder cars in mtcars",
      xlab = "Number of cylinders",
      ylab = "Frequency"
    )
  #+end_src

  #+RESULTS:
  [[file:../img/9_cyl_ann.png]]

* Practice: building a barplot

1) Download the data set from the Internet and turn it straightaway
   into a data frame using ~read.csv~
   #+begin_src R :results silent
     df <- read.csv(
       file="https://tinyurl.com/spdnvxbr",
       header=TRUE,
       stringsAsFactors=TRUE)
   #+end_src

2) Check the data out
   #+begin_src R
     str(df)
   #+end_src

   #+RESULTS:
   : 'data.frame':	10 obs. of  4 variables:
   :  $ Weight: int  55 85 75 42 93 63 58 75 89 67
   :  $ Height: int  161 185 174 154 188 178 170 167 181 178
   :  $ Sex   : Factor w/ 2 levels "female","male": 1 2 2 1 2 2 1 2 2 1
   :  $ Name  : Factor w/ 10 levels "Carl","Carla",..: 7 8 9 2 1 3 6 4 5 10

   #+begin_src R
     df
   #+end_src

   #+RESULTS:
   #+begin_example
      Weight Height    Sex  Name
   1      55    161 female  Jane
   2      85    185   male   Jim
   3      75    174   male   Joe
   4      42    154 female Carla
   5      93    188   male  Carl
   6      63    178   male Chris
   7      58    170 female  Dora
   8      75    167   male  Dave
   9      89    181   male Derek
   10     67    178 female Lucia
   #+end_example

3) Compute the frequency table for the variable ~Sex~ and store it in
   ~sex.freq~ 
   #+begin_src R
     sex.freq <- table(df$Sex)
     sex.freq
   #+end_src

   #+RESULTS:
   : 
   : female   male 
   :      4      6

4) What information does ~sex.freq~ contain?
   #+begin_quote
     The variable contains the number of male and female members of
     the data set.
   #+end_quote
   
5) Create a barplot for the ~Sex~ category - if you do this in Org-mode,
   you need to add ~:results graphics file :file file.png~ to your code
   block header. This will store the resulting plot in ~file.png~
   #+begin_src R :results graphics file :file ../img/9_sex.png
    barplot(height = sex.freq)
   #+end_src

   #+RESULTS:
   [[file:../img/9_sex.png]]

6) Annotate the barplot by adding a title and labels, and orient the
   axis labels horizontally by adding the parameter ~las=1~.
   #+begin_src R :results graphics file :file ../img/9_sex_ann.png
     barplot(
       height = sex.freq,
       main = "Number of males and females in dataset df",
       xlab = "Sex",
       ylab = "Frequency",
       las = 1)
   #+end_src

   #+RESULTS:
   [[file:../img/9_sex_ann.png]]

* TODO Building stacked/dodged barplots
* Footnotes

[fn:1]What are the categories used to organize the graphs?
Distribution, correlation and evolution (aka growth) relate to
statistical summaries. Spatial relates to an application, and the last
ones are qualitative characteristics related to patterns (part/whole),
order (ranking) and time (flow), showing special types of graphs (pie
chart, spider graph and line graph). The "Miscellaneous" category is
filled with fun examples, too.
